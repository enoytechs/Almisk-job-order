<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AL MISK Job Order System ‚Äî Tailwind Functional</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- remixicon -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <!-- html2pdf (optional, still included if you want PDF export later) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gradient-to-r from-indigo-100 to-purple-100 min-h-screen flex items-start py-8">

  <div class="w-full max-w-7xl mx-auto px-4">
    <div class="flex flex-col md:flex-row gap-6">

      <!-- LEFT: FORM -->
      <div id="form-section" class="flex-1 bg-white shadow-xl rounded-2xl border border-blue-200 p-6">
        <div class="flex items-start justify-between mb-4 border-b pb-4">
          <div>
            <h1 class="text-2xl font-bold text-blue-800">AL MISK FOR CARTON BXS CON S P LLC</h1>
            <p class="text-sm text-gray-600 mt-1">
              üìû 06-7420777 | üì± WhatsApp: 055-1440633<br>
              üì∏ @almisk.boxes | ‚úâÔ∏è almiskboxes@gmail.com
            </p>
          </div>
          <div class="bg-blue-700 text-white px-3 py-2 rounded text-sm font-semibold">AL MISK LOGO</div>
        </div>

        <h2 class="text-center text-lg font-semibold text-blue-700 mb-4">JOB ORDER FORM</h2>

        <form id="jobForm" class="space-y-4" autocomplete="off">
         
         <!-- Combined Row: Order Info (Always in One Line) -->
<div class="grid grid-cols-6 gap-3 whitespace-nowrap">
  <div>
    <label class="block text-sm font-semibold text-blue-800">Order Date *</label>
    <input name="orderDate" id="orderDate" type="date" required class="mt-1 w-full border rounded px-3 py-2 focus:ring focus:ring-blue-200">
  </div>

  <div>
    <label class="block text-sm font-semibold text-blue-800">Invoice No</label>
    <input name="invoiceNumber" id="invoiceNumber" type="text" readonly placeholder="Auto-assigned" class="mt-1 w-full border bg-gray-100 rounded px-3 py-2">
  </div>

  <div>
    <label class="block text-sm font-semibold text-blue-800">Contact Person *</label>
    <input name="contactPerson" id="contactPerson" type="text" required class="mt-1 w-full border rounded px-3 py-2 focus:ring focus:ring-blue-200">
  </div>

  <div>
    <label class="block text-sm font-semibold text-blue-800">Tel / Mobile *</label>
    <input name="telephone" id="telephone" type="text" required class="mt-1 w-full border rounded px-3 py-2 focus:ring focus:ring-blue-200">
  </div>

  <div>
    <label class="block text-sm font-semibold text-blue-800">Company Name</label>
    <input name="companyName" id="companyName" type="text" class="mt-1 w-full border rounded px-3 py-2">
  </div>

  <div>
    <label class="block text-sm font-semibold text-blue-800">Quantity *</label>
    <input name="quantity" id="quantity" type="number" min="1" required class="mt-1 w-full border rounded px-3 py-2">
  </div>
</div>


          <div>
            <label class="block text-sm font-semibold text-blue-800">Kind of Job</label>
            <input name="kindOfJob" id="kindOfJob" type="text" placeholder="Production / Sample / Prototype" class="mt-1 w-full border rounded px-3 py-2">
          </div>

          <!-- Product type & model -->
          <div class="rounded-md bg-blue-50 p-3">
            <div class="text-sm font-semibold text-blue-900 mb-2">PRODUCT TYPE & MODEL</div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
              <div>
                <label class="block text-sm font-semibold text-blue-800">Product Type *</label>
                <select name="productType" id="productType" required class="mt-1 w-full border rounded px-3 py-2">
                  <option value="">Select Type</option>
                  <option value="Box">Box</option>
                  <option value="Bag">Bag</option>
                  <option value="Sleeve">Sleeve</option>
                  <option value="Envelope">Envelope</option>
                </select>
              </div>

              <!-- Dynamic model container: will contain either select or input -->
              <div id="modelContainer">
                <label class="block text-sm font-semibold text-blue-800">Model / Variant *</label>
                <!-- default: select -->
                <select name="modelVariant" id="modelVariantSelect" required class="mt-1 w-full border rounded px-3 py-2">
                  <option value="">Select Type first</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-semibold text-blue-800">Dimensions / Notes</label>
                <input name="dimensions" id="dimensions" type="text" placeholder="e.g., 200√ó150√ó80 mm" class="mt-1 w-full border rounded px-3 py-2">
              </div>
            </div>
          </div>

      <!-- Production Specs -->
<div>
  <div class="text-sm font-semibold text-blue-900 mb-2">PRODUCTION SPECIFICATIONS</div>
  
  <!-- Two neat rows -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
    <select name="printingType" id="printingType" class="mt-1 w-full border rounded px-3 py-2">
      <option>Offset</option>
      <option>Digital</option>
    </select>

    <select name="lamination" id="lamination" class="mt-1 w-full border rounded px-3 py-2">
      <option>None</option>
      <option>Glossy</option>
      <option>Matt</option>
      <option>Soft-touch</option>
    </select>

    <select name="foiling" id="foiling" class="mt-1 w-full border rounded px-3 py-2">
      <option>None</option>
      <option>Gold</option>
      <option>Silver</option>
      <option>Rose Gold</option>
    </select>

    <select name="dieCutting" id="dieCutting" class="mt-1 w-full border rounded px-3 py-2">
      <option>None</option>
      <option>Full Cut</option>
      <option>Half Cut</option>
    </select>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
    <select name="embossingUV" id="embossingUV" class="mt-1 w-full border rounded px-3 py-2">
      <option>None</option>
      <option>Embossing</option>
      <option>Spot UV</option>
    </select>

    <select name="foamType" id="foamType" class="mt-1 w-full border rounded px-3 py-2">
      <option>None</option>
      <option>PVC</option>
      <option>Velvet</option>
      <option>PU</option>
    </select>

    <select name="paperType" id="paperType" class="mt-1 w-full border rounded px-3 py-2">
      <option>Gray Board</option>
      <option>Food Board</option>
      <option>Art Matt</option>
      <option>Sticker</option>
      <option>Special Paper</option>
    </select>
  </div>
</div>


          <!-- Remarks -->
          <div>
            <label class="block text-sm font-semibold text-blue-800">Remarks (max 500)</label>
            <textarea name="remarks" id="remarks" maxlength="500" class="mt-1 w-full border rounded px-3 py-2 h-10"></textarea>
            <div id="charCount" class="text-right text-xs text-gray-500 mt-1">0/500</div>
          </div>

          <!-- Attachments -->
          <div>
            <label class="block text-sm font-semibold text-blue-800">Upload Files (images only, max 5)</label>
            <input id="attachments" type="file" accept="image/*,.pdf" multiple class="mt-1 w-full border rounded px-3 py-2">
            <p class="text-xs text-gray-500 mt-1">Up to 5 images; PDFs will show filename preview.</p>

            <!-- preview grid: 3 per row on md -->
            <div id="attachmentPreview" class="mt-3 grid grid-cols-2 md:grid-cols-3 gap-3"></div>
          </div>

          <!-- manager / accountant / delivery -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <div>
              <label class="block text-sm font-semibold text-blue-800">Manager (Production)</label>
              <input name="managerProduction" id="managerProduction" type="text" class="mt-1 w-full border rounded px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-semibold text-blue-800">Accountant</label>
              <input name="accountant" id="accountant" type="text" class="mt-1 w-full border rounded px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-semibold text-blue-800">Delivery Date</label>
              <input name="deliveryDate" id="deliveryDate" type="date" class="mt-1 w-full border rounded px-3 py-2">
            </div>
          </div>

          <!-- signatures -->
          <div class="grid grid-cols-2 gap-4 pt-4 text-sm text-gray-600">
            <div class="border-t border-gray-300 pt-2 text-center">Customer Signature</div>
            <div class="border-t border-gray-300 pt-2 text-center">Manager Signature</div>
          </div>

          <p class="text-center text-xs text-blue-600">Quality Packaging Solutions | www.almisk.ae</p>

          <!-- Submit hidden (we will use custom buttons) -->
          <button type="submit" id="submitBtn" class="hidden">Submit</button>
        </form>

        <!-- actions -->
        <div class="mt-5 flex flex-wrap gap-3 justify-center">
          <button id="addJobBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold">‚ûï Add Job</button>
          <button id="printColor" class="bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded font-semibold">üñ® Print Color</button>
          <button id="printBW" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded font-semibold">üñ® Print B&W</button>
          <button id="saveDraft" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold">üíæ Save Draft</button>
          <button id="clearForm" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-semibold">üßπ Clear Form</button>
          <button id="exportAllJSON" class="bg-blue-400 hover:bg-blue-500 text-white px-4 py-2 rounded font-semibold">üì¶ Export All JSON</button>
        </div>
      </div>

      <!-- RIGHT: JOB LIST -->
      <div class="w-full hidden  md:w-80 bg-white shadow-lg rounded-2xl p-4">
        <h3 class="flex items-center justify-between text-lg font-semibold text-blue-700 mb-3 border-b pb-2">
          Jobs / Todo
          <span id="jobCount" class="text-sm bg-blue-50 text-gray-700 px-2 py-0.5 rounded">0</span>
        </h3>

        <div id="jobList" class="space-y-2 text-sm text-gray-700 min-h-[120px]">
          <p>No jobs yet. Add via form.</p>
        </div>

        <div class="mt-4 flex flex-col gap-2">
          <button id="clearAllJobs" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded">üóë Clear All</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* -------------------------
  Functional JS: form + jobs
   - Add job
   - Render jobs
   - Load job into form
   - ProductType -> model logic (Box => input)
   - Attachments preview (max 5)
   - Draft autosave + manual save
   - Print color / B&W
------------------------- */

document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const form = document.getElementById('jobForm');
  const addJobBtn = document.getElementById('addJobBtn');
  const jobListEl = document.getElementById('jobList');
  const jobCountEl = document.getElementById('jobCount');
  const attachmentsInput = document.getElementById('attachments');
  const attachmentPreview = document.getElementById('attachmentPreview');
  const remarks = document.getElementById('remarks');
  const charCount = document.getElementById('charCount');
  const productType = document.getElementById('productType');
  const modelContainer = document.getElementById('modelContainer');
  const invoiceNumberField = document.getElementById('invoiceNumber');

  // Buttons
  const saveDraftBtn = document.getElementById('saveDraft');
  const clearFormBtn = document.getElementById('clearForm');
  const printColorBtn = document.getElementById('printColor');
  const printBWBtn = document.getElementById('printBW');
  const exportAllJSONBtn = document.getElementById('exportAllJSON');
  const clearAllJobsBtn = document.getElementById('clearAllJobs');

  // Model options map
  const modelOptions = {
    Box: ["RSC (Regular Slotted Container)", "Auto-Lock Bottom", "Die-cut Window Box"],
    Bag: ["Flat Bag", "D-cut Handle Bag", "Punch Handle Bag"],
    Sleeve: ["Slip Sleeve", "Drawer Sleeve", "Telescopic Sleeve"],
    Envelope: ["Standard Flap", "Window Envelope", "Wallet Flap"]
  };

  // Utility: jobs storage
  const getJobs = () => JSON.parse(localStorage.getItem('jobs') || '[]');
  const saveJobs = (arr) => localStorage.setItem('jobs', JSON.stringify(arr));

  // Invoice generator
  function generateInvoice() {
    let last = parseInt(localStorage.getItem('lastInvoiceNumber') || '1000', 10);
    last += 1;
    localStorage.setItem('lastInvoiceNumber', last);
    return `INV-${last}`;
  }

  // Keep invoice number shown as next invoice when form loads
  function refreshInvoicePreview() {
    const next = parseInt(localStorage.getItem('lastInvoiceNumber') || '1000', 10) + 1;
    invoiceNumberField.value = `INV-${next}`;
  }
  refreshInvoicePreview();

  // Render jobs
  function renderJobs() {
    const jobs = getJobs();
    jobListEl.innerHTML = '';
    if (!jobs.length) {
      jobListEl.innerHTML = '<p>No jobs yet. Add via form.</p>';
      jobCountEl.textContent = '0';
      return;
    }
    jobs.forEach((job, i) => {
      const div = document.createElement('div');
      div.className = 'p-2 border rounded hover:bg-blue-50 cursor-pointer flex items-center justify-between';
      const left = document.createElement('div');
      left.innerHTML = `<div class="font-semibold text-sm">${job.invoice}</div>
                        <div class="text-xs text-gray-600">${job.contactPerson || 'N/A'} ‚Äî ${job.companyName || 'N/A'}</div>
                        <div class="text-xs text-gray-500">${job.productType || ''} / ${job.modelVariant || ''}</div>`;
      const right = document.createElement('div');
      right.innerHTML = `<div class="text-xs px-2 py-1 rounded text-white bg-yellow-500">Todo</div>`;
      div.appendChild(left);
      div.appendChild(right);
      div.addEventListener('click', () => loadJob(i));
      jobListEl.appendChild(div);
    });
    jobCountEl.textContent = jobs.length.toString();
  }

  // Load job into form
  function loadJob(index) {
    const jobs = getJobs();
    if (!jobs[index]) return;
    const job = jobs[index];

    // Reset model container before setting
    setModelInputForProduct(job.productType || '');

    // Fill fields
    const fields = [
      'orderDate','invoiceNumber','contactPerson','telephone','companyName','quantity','kindOfJob',
      'dimensions','printingType','lamination','foiling','dieCutting','embossingUV','foamType','paperType',
      'remarks','managerProduction','accountant','deliveryDate'
    ];
    fields.forEach(name => {
      const el = form.elements[name];
      if (el) el.value = job[name] || '';
    });

    // modelVariant may be in select or input
    const modelSelect = document.getElementById('modelVariantSelect');
    const modelInput = document.getElementById('modelVariantInput');
    if (modelSelect) modelSelect.value = job.modelVariant || '';
    if (modelInput) modelInput.value = job.modelVariant || '';

    // attachments preview won't be reloaded (we only stored filenames); show filenames if present
    attachmentPreview.innerHTML = '';
    if (job.attachments && job.attachments.length) {
      job.attachments.slice(0,5).forEach(att => {
        if (att.type === 'image' && att.dataUrl) {
          const img = document.createElement('img');
          img.src = att.dataUrl;
          img.className = 'w-full h-24 object-cover rounded border';
          attachmentPreview.appendChild(img);
        } else {
          const p = document.createElement('div');
          p.className = 'text-xs text-gray-600 p-2 border rounded';
          p.textContent = att.name || 'file';
          attachmentPreview.appendChild(p);
        }
      });
    }

    showToast('Loaded job into form', 'info');
  }

  // Show toast
  function showToast(msg, type='info') {
    const t = document.createElement('div');
    t.className = 'fixed bottom-6 right-6 bg-blue-600 text-white px-4 py-2 rounded shadow';
    if (type === 'success') t.style.background = '#16a34a';
    if (type === 'error') t.style.background = '#dc2626';
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(()=> t.remove(), 2200);
  }

  // Character counter for remarks
  remarks.addEventListener('input', () => {
    charCount.textContent = `${remarks.value.length}/500`;
  });

  // Attachments preview + store dataUrls in memory when adding job
  attachmentsInput.addEventListener('change', (e) => {
    attachmentPreview.innerHTML = '';
    const files = Array.from(e.target.files).slice(0,5); // limit 5
    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = ev => {
        if (file.type.startsWith('image/')) {
          const img = document.createElement('img');
          img.src = ev.target.result;
          img.className = 'w-full h-24 object-cover rounded border';
          attachmentPreview.appendChild(img);
        } else {
          const d = document.createElement('div');
          d.className = 'text-xs text-gray-700 p-2 border rounded';
          d.textContent = file.name;
          attachmentPreview.appendChild(d);
        }
      };
      reader.readAsDataURL(file);
    });
  });

  // Product type change: swap model input/select
  function setModelInputForProduct(type) {
    modelContainer.innerHTML = ''; // clear
    const label = document.createElement('label');
    label.className = 'block text-sm font-semibold text-blue-800';
    label.textContent = 'Model / Variant *';
    modelContainer.appendChild(label);

    // For Box: use a free text input (user asked to change spinner to input)
    if (type === 'Box') {
      const input = document.createElement('input');
      input.name = 'modelVariant';
      input.id = 'modelVariantInput';
      input.required = true;
      input.placeholder = 'Type box model (e.g., RSC custom)';
      input.className = 'mt-1 w-full border rounded px-3 py-2';
      modelContainer.appendChild(input);
    } else {
      // use select with options (for Bag/Sleeve/Envelope and default)
      const select = document.createElement('select');
      select.name = 'modelVariant';
      select.id = 'modelVariantSelect';
      select.required = true;
      select.className = 'mt-1 w-full border rounded px-3 py-2';
      // default empty option
      const optDefault = document.createElement('option');
      optDefault.value = '';
      optDefault.textContent = 'Select Model';
      select.appendChild(optDefault);
      if (modelOptions[type]) {
        modelOptions[type].forEach(m => {
          const o = document.createElement('option');
          o.value = m;
          o.textContent = m;
          select.appendChild(o);
        });
      }
      modelContainer.appendChild(select);
    }
  }

  // initial model container default (select placeholder)
  setModelInputForProduct('');

  // on product type change
  productType.addEventListener('change', (e) => {
    setModelInputForProduct(e.target.value);
  });

  // Add job - validate and store
  addJobBtn.addEventListener('click', (e) => {
    e.preventDefault();

    // collect required fields validation
    const orderDate = form.elements['orderDate'].value.trim();
    const contactPerson = form.elements['contactPerson'].value.trim();
    const telephone = form.elements['telephone'].value.trim();
    const quantity = form.elements['quantity'].value.trim();
    const productTypeVal = form.elements['productType'].value;
    const modelElSelect = document.getElementById('modelVariantSelect');
    const modelElInput = document.getElementById('modelVariantInput');
    const modelVariant = modelElInput ? modelElInput.value.trim() : (modelElSelect ? modelElSelect.value : '');

    if (!orderDate || !contactPerson || !telephone || !quantity || !productTypeVal || !modelVariant) {
      showToast('Please fill all required fields.', 'error');
      return;
    }

    // Create job object
    const invoice = generateInvoice();
    const job = {
      invoice,
      orderDate,
      contactPerson,
      telephone,
      companyName: form.elements['companyName'].value || '',
      quantity,
      kindOfJob: form.elements['kindOfJob'].value || '',
      productType: productTypeVal,
      modelVariant,
      dimensions: form.elements['dimensions'].value || '',
      printingType: form.elements['printingType'].value || '',
      lamination: form.elements['lamination'].value || '',
      foiling: form.elements['foiling'].value || '',
      dieCutting: form.elements['dieCutting'].value || '',
      embossingUV: form.elements['embossingUV'].value || '',
      foamType: form.elements['foamType'].value || '',
      paperType: form.elements['paperType'].value || '',
      remarks: form.elements['remarks'].value || '',
      managerProduction: form.elements['managerProduction'].value || '',
      accountant: form.elements['accountant'].value || '',
      deliveryDate: form.elements['deliveryDate'].value || '',
      attachments: [] // we'll store small metadata + dataUrls for images for preview on load
    };

    // read attachments (if any) as dataUrls for preview later and store name/type
    const files = Array.from(attachmentsInput.files || []).slice(0,5);
    const filePromises = files.map(file => new Promise((res) => {
      const reader = new FileReader();
      reader.onload = (ev) => {
        const isImage = file.type.startsWith('image/');
        res({
          name: file.name,
          type: isImage ? 'image' : 'file',
          dataUrl: ev.target.result
        });
      };
      reader.readAsDataURL(file);
    }));

    Promise.all(filePromises).then(results => {
      job.attachments = results;
      // persist into localStorage
      const jobs = getJobs();
      jobs.push(job);
      saveJobs(jobs);
      renderJobs();
      showToast('Job added successfully!', 'success');

      // reset form (but keep next invoice preview updated)
      form.reset();
      attachmentPreview.innerHTML = '';
      remarks.value = '';
      charCount.textContent = '0/500';
      refreshInvoicePreview();
    }).catch(err => {
      console.error(err);
      showToast('Error adding attachments', 'error');
    });
  });

  // Save draft manually
  saveDraftBtn.addEventListener('click', () => {
    const data = collectFormDataForDraft();
    localStorage.setItem('draft', JSON.stringify(data));
    showToast('Draft saved', 'success');
  });

  // Auto-save draft every 20s
  setInterval(() => {
    try {
      const data = collectFormDataForDraft();
      localStorage.setItem('draft', JSON.stringify(data));
    } catch (err) {
      // ignore
    }
  }, 20000);

  // Load draft on start
  (function loadDraft() {
    const draft = JSON.parse(localStorage.getItem('draft') || 'null');
    if (!draft) return;
    // set product type first so model container correct
    if (draft.productType) {
      form.elements['productType'].value = draft.productType;
      setModelInputForProduct(draft.productType);
    }
    // populate fields
    Object.keys(draft).forEach(k => {
      if (k === 'modelVariant') {
        const ms = document.getElementById('modelVariantSelect');
        const mi = document.getElementById('modelVariantInput');
        if (ms) ms.value = draft[k];
        if (mi) mi.value = draft[k];
      } else {
        if (form.elements[k]) form.elements[k].value = draft[k];
      }
    });

    // attachments preview from draft (if images)
    if (draft.attachments && draft.attachments.length) {
      attachmentPreview.innerHTML = '';
      draft.attachments.slice(0,5).forEach(att => {
        if (att.type === 'image' && att.dataUrl) {
          const img = document.createElement('img');
          img.src = att.dataUrl;
          img.className = 'w-full h-24 object-cover rounded border';
          attachmentPreview.appendChild(img);
        } else {
          const d = document.createElement('div');
          d.className = 'text-xs text-gray-700 p-2 border rounded';
          d.textContent = att.name || 'file';
          attachmentPreview.appendChild(d);
        }
      });
    }
  })();

  // collect form data for draft (including attachments preview dataUrls if present)
  function collectFormDataForDraft() {
    const data = {};
    Array.from(form.elements).forEach(el => {
      if (!el.name) return;
      if (el.type === 'file') return; // we'll collect attachments separately
      data[el.name] = el.value;
    });
    // attachments: capture preview images from attachmentPreview (if any)
    const previewImgs = Array.from(attachmentPreview.querySelectorAll('img'));
    data.attachments = previewImgs.map(img => ({ type: 'image', dataUrl: img.src }));
    return data;
  }

  // Clear form
  clearFormBtn.addEventListener('click', () => {
    if (!confirm('Clear all fields?')) return;
    form.reset();
    attachmentPreview.innerHTML = '';
    remarks.value = '';
    charCount.textContent = '0/500';
    setModelInputForProduct('');
    refreshInvoicePreview();
    showToast('Form cleared', 'info');
  });

  // Print color
  printColorBtn.addEventListener('click', () => {
    document.body.classList.remove('pdf-export');
    window.print();
  });

  // Print B&W
  printBWBtn.addEventListener('click', () => {
    document.body.style.filter = 'grayscale(1)';
    window.print();
    setTimeout(()=> { document.body.style.filter = 'none'; }, 500);
  });

  // Export All JSON
  exportAllJSONBtn.addEventListener('click', () => {
    const jobs = getJobs();
    if (!jobs.length) {
      showToast('No jobs to export', 'error');
      return;
    }
    const blob = new Blob([JSON.stringify(jobs, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'jobs.json';
    a.click();
  });

  // Clear all jobs
  clearAllJobsBtn.addEventListener('click', () => {
    if (!confirm('Delete all jobs?')) return;
    localStorage.removeItem('jobs');
    renderJobs();
    showToast('All jobs deleted', 'success');
  });

  // initial render jobs
  renderJobs();

  // keyboard shortcuts: Ctrl+S save draft, Ctrl+P print
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key.toLowerCase() === 's') {
      e.preventDefault();
      saveDraftBtn.click();
    }
    if (e.ctrlKey && e.key.toLowerCase() === 'p') {
      e.preventDefault();
      printColorBtn.click();
    }
  });

}); // DOMContentLoaded
</script>
</body>
</html>
